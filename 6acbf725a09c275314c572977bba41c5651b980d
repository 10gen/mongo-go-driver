{
  "comments": [
    {
      "key": {
        "uuid": "d44a927a_1a66b7c4",
        "filename": "x/mongo/driver/topology/topology_options.go",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1015492
      },
      "writtenOn": "2019-02-19T00:34:33Z",
      "side": 1,
      "message": "I don\u0027t like introducing a panic here. Perhaps you can see a better way of initializing a compressor per connection?",
      "revId": "6acbf725a09c275314c572977bba41c5651b980d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "20d0a1ac_e12805f3",
        "filename": "x/mongo/driver/topology/topology_options.go",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2019-02-19T16:25:21Z",
      "side": 1,
      "message": "I\u0027m missing why we need to put this inside the options function. We should be properly closing around the comp instance.",
      "parentUuid": "d44a927a_1a66b7c4",
      "revId": "6acbf725a09c275314c572977bba41c5651b980d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5fb73df5_43118802",
        "filename": "x/mongo/driver/topology/topology_options.go",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1015492
      },
      "writtenOn": "2019-02-19T16:43:58Z",
      "side": 1,
      "message": "topology.WithConnString is called once per client initialization. The closure causes each connection to use the same compressor that was initialized in topology.WithConnString.\n\nTo solve this it doesn\u0027t need to be inside the options function. That\u0027s just one way of ensuring a new compressor is initialized for each connection. \n\nAnother option would be adding a compressorType []string field to Connection. Then connection.WithCompressors appends the string \"zlib\" and/or \"snappy\" to that field. Then we can initialize the compressor from Connection.New(). That might be a little cleaner actually.",
      "parentUuid": "20d0a1ac_e12805f3",
      "revId": "6acbf725a09c275314c572977bba41c5651b980d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "edf709f6_fb98a3ea",
        "filename": "x/mongo/driver/topology/topology_options.go",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2019-02-19T16:58:18Z",
      "side": 1,
      "message": "I agree that moving the compressor initialization of a connection makes sense. It also solves the issue with returning the error. I would say we can just set the compressors and the zlib level in the connection.config type and split the options, i.e. WithCompressors and WithZLibLevel.",
      "parentUuid": "5fb73df5_43118802",
      "revId": "6acbf725a09c275314c572977bba41c5651b980d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59980fa6_6984d84f",
        "filename": "x/mongo/driver/topology/topology_options.go",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1015492
      },
      "writtenOn": "2019-02-19T20:07:01Z",
      "side": 1,
      "message": "Okay I\u0027ll take a stab at it. Thanks for the review!",
      "parentUuid": "edf709f6_fb98a3ea",
      "revId": "6acbf725a09c275314c572977bba41c5651b980d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "984ddbae_d0fced9f",
        "filename": "x/mongo/driver/topology/topology_options.go",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1015492
      },
      "writtenOn": "2019-02-25T19:51:44Z",
      "side": 1,
      "message": "I submitted a new patchset with these changes. Please let me know what you think :)",
      "parentUuid": "59980fa6_6984d84f",
      "revId": "6acbf725a09c275314c572977bba41c5651b980d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2e4198ce_808b1468",
        "filename": "x/mongo/driver/topology/topology_options.go",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1015311
      },
      "writtenOn": "2019-02-26T17:53:20Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "984ddbae_d0fced9f",
      "revId": "6acbf725a09c275314c572977bba41c5651b980d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}