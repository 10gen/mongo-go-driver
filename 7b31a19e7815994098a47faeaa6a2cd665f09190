{
  "comments": [
    {
      "key": {
        "uuid": "f0ece77d_e7d5aae1",
        "filename": "core/command/aggregate.go",
        "patchSetId": 8
      },
      "lineNbr": 144,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-03T20:49:13Z",
      "side": 1,
      "message": "I don\u0027t know if we should do this. I think it would be wise to see what other drivers that have implemented this are doing. I think the server always sends back a response to the aggregate command since it isn\u0027t a write command.",
      "range": {
        "startLine": 144,
        "startChar": 2,
        "endLine": 144,
        "endChar": 46
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f7576d9_6deb906d",
        "filename": "core/command/aggregate.go",
        "patchSetId": 8
      },
      "lineNbr": 144,
      "author": {
        "id": 1013848
      },
      "writtenOn": "2018-07-03T21:04:36Z",
      "side": 1,
      "message": "The moreToCome flag applies to any command, not only insert/update/delete.  But regardless, no drivers that I\u0027m aware of will set !moreToCome on any commands besides those three, since historically the only old wire protocol message types that supported similar behavior are OP_INSERT/UPDATE/DELETE.\n\nFor aggregate, the only time this would even make sense is when the last stage is $out.  Otherwise, the driver MUST NOT set !moreToCome if w\u003d0, since the aggregate is a read not a write.\n\nYou should ditch this code, and just assume that all aggregate commands will return a response regardless of the write concern.",
      "parentUuid": "f0ece77d_e7d5aae1",
      "range": {
        "startLine": 144,
        "startChar": 2,
        "endLine": 144,
        "endChar": 46
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ce92b83_644ff265",
        "filename": "core/command/create_indexes.go",
        "patchSetId": 8
      },
      "lineNbr": 91,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-03T20:49:13Z",
      "side": 1,
      "message": "We should just add wiremessage.ReadWriteCloser to the white list for err check, this is quite ugly.",
      "range": {
        "startLine": 91,
        "startChar": 3,
        "endLine": 91,
        "endChar": 36
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "197db326_45f65abe",
        "filename": "core/command/delete.go",
        "patchSetId": 8
      },
      "lineNbr": 113,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-03T20:49:13Z",
      "side": 1,
      "message": "We should only do this if we don\u0027t have an OP_MSG wiremessage.",
      "range": {
        "startLine": 113,
        "startChar": 3,
        "endLine": 113,
        "endChar": 33
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a0a45d57_0d6154dc",
        "filename": "core/command/delete.go",
        "patchSetId": 8
      },
      "lineNbr": 113,
      "author": {
        "id": 1013853
      },
      "writtenOn": "2018-07-04T17:25:34Z",
      "side": 1,
      "message": "How does \"Delete\" know? I guess it can check the type of the wire message, but now we have to check the type of the wire message everywhere... which means this is getting a bit out of control. This logic needs to be centralized somewhere. And it seems like it already is (inside command.Write). But we create a command.Write to encode and decode, but not to round trip. It feels like there is some advantage we could get here if we re-used that code.",
      "parentUuid": "197db326_45f65abe",
      "range": {
        "startLine": 113,
        "startChar": 3,
        "endLine": 113,
        "endChar": 33
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5a388ef9_6e4e8e28",
        "filename": "core/command/delete.go",
        "patchSetId": 8
      },
      "lineNbr": 113,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-05T15:22:50Z",
      "side": 1,
      "message": "We can refactor the code to avoid repetition, but right now this code is wrong and will cause both goroutine and connection leaks. We likely need to add an \"encode\" and \"decode\" method that only does the part of the processing that results in a command.Write or the result from decoding a command.Write.",
      "parentUuid": "a0a45d57_0d6154dc",
      "range": {
        "startLine": 113,
        "startChar": 3,
        "endLine": 113,
        "endChar": 33
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "56a9ef45_9630f1bb",
        "filename": "core/command/insert.go",
        "patchSetId": 8
      },
      "lineNbr": 201,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-03T20:49:13Z",
      "side": 1,
      "message": "I think we can remove a lot of this error tracking.",
      "range": {
        "startLine": 177,
        "startChar": 4,
        "endLine": 201,
        "endChar": 16
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "951818a5_d1a55505",
        "filename": "core/command/insert.go",
        "patchSetId": 8
      },
      "lineNbr": 201,
      "author": {
        "id": 1013853
      },
      "writtenOn": "2018-07-04T17:25:34Z",
      "side": 1,
      "message": "can you elaborate? Which errors in here don\u0027t need to be handled?",
      "parentUuid": "56a9ef45_9630f1bb",
      "range": {
        "startLine": 177,
        "startChar": 4,
        "endLine": 201,
        "endChar": 16
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "911393e3_251d2755",
        "filename": "core/command/insert.go",
        "patchSetId": 8
      },
      "lineNbr": 201,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-05T15:22:50Z",
      "side": 1,
      "message": "The ones that don\u0027t result in a return. We don\u0027t need to track the result.Insert instance since we don\u0027t do anything with it after this goroutine finishes.",
      "parentUuid": "951818a5_d1a55505",
      "range": {
        "startLine": 177,
        "startChar": 4,
        "endLine": 201,
        "endChar": 16
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b71fe59d_6c2b1565",
        "filename": "core/command/insert.go",
        "patchSetId": 8
      },
      "lineNbr": 201,
      "author": {
        "id": 1013853
      },
      "writtenOn": "2018-07-05T15:48:00Z",
      "side": 1,
      "message": "ah yes, I see... this is unacknowledged. Technically, since this is unacknowldedged, even the ones with returns should be checked. We should just send everything.  @jeff would be able to give a better understanding of what should happen here.",
      "parentUuid": "911393e3_251d2755",
      "range": {
        "startLine": 177,
        "startChar": 4,
        "endLine": 201,
        "endChar": 16
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16eb68c8_87abc941",
        "filename": "core/command/insert.go",
        "patchSetId": 8
      },
      "lineNbr": 201,
      "author": {
        "id": 1013848
      },
      "writtenOn": "2018-07-05T17:57:01Z",
      "side": 1,
      "message": "There is no need to check write concern error or track anything in res for unacknowledged writes.  However, it seems like this code could be pulled out into a common subroutine shared by both the acknowledged and unacknowledged cases.",
      "parentUuid": "b71fe59d_6c2b1565",
      "range": {
        "startLine": 177,
        "startChar": 4,
        "endLine": 201,
        "endChar": 16
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48513ec8_5c1f3869",
        "filename": "mongo/collection.go",
        "patchSetId": 8
      },
      "lineNbr": 133,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-03T20:49:13Z",
      "side": 1,
      "message": "While this works, I think it might be a little confusing for people not using the mongo package that the write concern on the command isn\u0027t automatically turned into an option and placed in the serialized command.",
      "range": {
        "startLine": 123,
        "startChar": 1,
        "endLine": 133,
        "endChar": 2
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "11583178_1e3e6513",
        "filename": "mongo/collection.go",
        "patchSetId": 8
      },
      "lineNbr": 133,
      "author": {
        "id": 1013853
      },
      "writtenOn": "2018-07-04T17:25:34Z",
      "side": 1,
      "message": "While that is something to think about, people not using the mongo package have taken on the responsibility of handling this type of situation. My suggestion to combat this would be to simply remove the core\u0027s notion of a write concern option. The ONLY way to provide a write concern (read pref? read concern?) is to provide on this struct itself. That way, no confusion.",
      "parentUuid": "48513ec8_5c1f3869",
      "range": {
        "startLine": 123,
        "startChar": 1,
        "endLine": 133,
        "endChar": 2
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b4ad2e3d_5557d004",
        "filename": "mongo/collection.go",
        "patchSetId": 8
      },
      "lineNbr": 133,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-05T15:22:50Z",
      "side": 1,
      "message": "I don\u0027t think we should have anyone who uses the Core API get in the situation where the write concern used to evaluate what we do with a command and the write concern serialized into options are different.",
      "parentUuid": "11583178_1e3e6513",
      "range": {
        "startLine": 123,
        "startChar": 1,
        "endLine": 133,
        "endChar": 2
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9eeff20f_388bb95c",
        "filename": "mongo/collection.go",
        "patchSetId": 8
      },
      "lineNbr": 133,
      "author": {
        "id": 1013853
      },
      "writtenOn": "2018-07-05T15:48:00Z",
      "side": 1,
      "message": "Hence why I suggested removing the option itself and requiring it be provided on the struct itself.",
      "parentUuid": "b4ad2e3d_5557d004",
      "range": {
        "startLine": 123,
        "startChar": 1,
        "endLine": 133,
        "endChar": 2
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "653031b4_ca019d0c",
        "filename": "mongo/collection.go",
        "patchSetId": 8
      },
      "lineNbr": 631,
      "author": {
        "id": 1001503
      },
      "writtenOn": "2018-07-03T20:49:13Z",
      "side": 1,
      "message": "This block of code makes me wonder if we should have readconcern on the command itself, but it isn\u0027t of the same level as read preference or write concern.",
      "range": {
        "startLine": 620,
        "startChar": 0,
        "endLine": 631,
        "endChar": 0
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0e5aa287_3a2571d3",
        "filename": "mongo/collection.go",
        "patchSetId": 8
      },
      "lineNbr": 631,
      "author": {
        "id": 1014457
      },
      "writtenOn": "2018-07-05T13:31:44Z",
      "side": 1,
      "message": "We could; though we liked it this way since we didn\u0027t need to pull ReadConcern out like we did for WriteConcern and look at it, so it seemed nicer to just wrap it in an option and store it away at this level",
      "parentUuid": "653031b4_ca019d0c",
      "range": {
        "startLine": 620,
        "startChar": 0,
        "endLine": 631,
        "endChar": 0
      },
      "revId": "7b31a19e7815994098a47faeaa6a2cd665f09190",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}