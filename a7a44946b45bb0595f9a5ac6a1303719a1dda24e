{
  "comments": [
    {
      "key": {
        "uuid": "5511d8b9_29cf3346",
        "filename": "mongo/client.go",
        "patchSetId": 9
      },
      "lineNbr": 133,
      "author": {
        "id": 1013853
      },
      "writtenOn": "2018-07-17T21:57:02Z",
      "side": 1,
      "message": "You are going to want to find out if there is a server to send this too. Otherwise, you might end up in a situation where you can\u0027t select a server to send the endSessions command to and just hang for a while, and then ultimately never complete the Disconnect call.",
      "revId": "a7a44946b45bb0595f9a5ac6a1303719a1dda24e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "591662e7_45c4b49a",
        "filename": "mongo/client.go",
        "patchSetId": 9
      },
      "lineNbr": 133,
      "author": {
        "id": 1013848
      },
      "writtenOn": "2018-07-18T00:25:24Z",
      "side": 1,
      "message": "To add to this: the method should try to find out if there is an available server to send it to _without_ blocking (as you would by calling Topology.SelectServer).  Instead, I think you could do something like:\n\n   selector.SelectServer(c.topology.Description(), ...)\n\nwhich doesn\u0027t block.  And then only call dispatch.EndSessions if there is a currently available server.  There\u0027s a small race here, as between the two calls the server could become unavailable, but it\u0027s an improvement.  See https://jira.mongodb.org/browse/JAVA-2859 for the motivation behind this.\n\nAlso, the spec says: \"When connected to a replica set the endSessions command MUST be sent to the primary if the primary is available, otherwise it MUST be sent to any available secondary.\"\n\nSo instead of using description.WriteSelector() it should use description.ReadPrefSelector(readPref.PrimaryPreferred())",
      "parentUuid": "5511d8b9_29cf3346",
      "revId": "a7a44946b45bb0595f9a5ac6a1303719a1dda24e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b33ca614_ed45ad1e",
        "filename": "mongo/client.go",
        "patchSetId": 9
      },
      "lineNbr": 133,
      "author": {
        "id": 1014457
      },
      "writtenOn": "2018-07-18T15:55:08Z",
      "side": 1,
      "message": "Since dispatch normally does server selection, would it make more sense then to have this logic in dispatch (i.e. do a manual server selection, and if it fails just ignore the command altogether?",
      "parentUuid": "591662e7_45c4b49a",
      "revId": "a7a44946b45bb0595f9a5ac6a1303719a1dda24e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}